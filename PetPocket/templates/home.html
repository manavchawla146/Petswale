<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PetPocket Navbar</title>
  <link rel="stylesheet" href="{{url_for('static', filename='css/style.css')}}">
  <link rel="stylesheet" href="{{url_for('static', filename='css/premium-diet.css')}}">
  <link rel="stylesheet" href="{{url_for('static', filename='css/newsletter.css')}}">
  <link rel="stylesheet" href="{{url_for('static', filename='css/navbar.css')}}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script src="{{url_for('static', filename='js/script.js')}}" defer></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800&display=swap');
  </style>
</head>
<body>
  {% include 'navbar.html' %}
  <section class="hero">
    <div class="carousel">
      <div class="slide">
        <div class="slide-content">
          <h2 class="slide-title">Find Your Purr-fect Match</h2>
          <p class="slide-description">Discover adorable pets and premium products tailored to their needs.</p>
        </div>
        <div class="slide-image">
          <img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/img-4.png" alt="Cute Cat">
        </div>
      </div>
      <div class="slide">
        <div class="slide-content">
          <h2 class="slide-title">Premium Products for Happy Pets</h2>
          <p class="slide-description">Spoil your furry friends with high-quality food, toys, and accessories.</p>
        </div>
        <div class="slide-image">
          <img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/img-10.png" alt="Happy Dog">
        </div>
      </div>
      <div class="slide">
        <div class="slide-content">
          <h2 class="slide-title">Expert Advice on Pet Care</h2>
          <p class="slide-description">Get tips and tricks from our pet experts to keep your companions healthy and thriving.</p>
        </div>
        <div class="slide-image">
          <img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/img-14.png" alt="Pet Experts">
        </div>
      </div>
      <button class="carousel-control prev">
        <span class="material-symbols-outlined">arrow_back_ios</span>
      </button>
      <button class="carousel-control next">
        <span class="material-symbols-outlined">arrow_forward_ios</span>
      </button>
    </div>
  </section>

  <section class="shop-by-category">
    <h2>Shop by Category <img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/icon.png" alt=""></h2>
    <div class="category-cards">
      {% for pet_type in pet_types %}
      <div class="category-card">
        <img src="{{ pet_type.image_url or 'https://placehold.co/200x200' }}" 
             alt="{{ pet_type.name }}" 
             onclick="window.location.href = '{{ url_for('main.products', pet_type_id=pet_type.id) }}'">
        <h3>{{ pet_type.name }}</h3>
      </div>
      {% endfor %}
    </div>
  </section>

  <section class="product-list">
    <h2>Recommended Products <img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/icon.png" alt=""></h2>
    <div class="product-slider">
      <div class="product-cards" id="recommended-products">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
      </div>
      <div class="product-slider-controls">
        <button class="product-slider-control prev">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </button>
        <button class="product-slider-control next">
          <span class="material-symbols-outlined">arrow_forward_ios</span>
        </button>
      </div>
    </div>
  </section>

  <section class="product-list">
    <h2>Pet Parent Loves This <img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/icon.png" alt=""></h2>
    <div class="product-slider">
      <div class="product-cards" id="pet-parent-loves">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
      </div>
      <div class="product-slider-controls">
        <button class="product-slider-control prev">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </button>
        <button class="product-slider-control next">
          <span class="material-symbols-outlined">arrow_forward_ios</span>
        </button>
      </div>
    </div>
  </section>

  <section class="product-list">
    <h2>Best Seller <img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/icon.png" alt=""></h2>
    <div class="product-slider">
      <div class="product-cards" id="best-sellers">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
      </div>
      <div class="product-slider-controls">
        <button class="product-slider-control prev">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </button>
        <button class="product-slider-control next">
          <span class="material-symbols-outlined">arrow_forward_ios</span>
        </button>
      </div>
    </div>
  </section>

  <section class="reviews">
    <h2 class="section-title"><img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/img-24.png" alt="">What Pet Parents Say</h2>
    <div class="reviews-container">
      <div class="reviews-grid">
        <div class="review-card">
          <div class="review-profile">
            <div class="review-avatar" style="overflow: hidden;">
              <img src="https://img.freepik.com/premium-photo/young-caucasian-girl-with-sincere-smile-takes-selfie-with-black-white-dog-arms-pink-background-pets-concept_197531-31339.jpg?ga=GA1.1.874350228.1720606149&semt=ais_hybrid"
                alt="" style="height: 100%; width: 100%; object-fit: cover;">
            </div>
            <div class="review-info">
              <h3>Sarah Johnson</h3>
              <div class="stars">★★★★★</div>
            </div>
          </div>
          <p class="review-text">"The products are amazing! My dog loves his new toys and the quality is outstanding. Definitely coming back for more!"</p>
          <div class="review-pet">Dog Parent</div>
        </div>
        <!-- Other review cards -->
      </div>
    </div>
  </section>

  <section class="new-pet-banner">
    <div class="np-content">
      <div class="np-text">
        <h2>New Pet at Home?</h2>
        <p>Let's make their transition smooth and comfortable</p>
        <div class="tip-container">
          <div class="tip" onclick="window.open('https://petsatlas.com/pet-products-for-new-pet-owners-in-india/','_blank')">
            <i class="fa-solid fa-dog"></i>
            <span>Starter Essential Gear for Your New Friend</span>
          </div>
          <div class="tip" onclick="window.open('https://www.24petwatch.com/blog/new-dog-or-cat-the-ultimate-checklist-for-new-pet-parents','_blank')">
            <i class="fa-solid fa-cat"></i>
            <span>Training Made Easy </span>
          </div>
          <div class="tip" onclick="window.open('https://www.vetchatbot.com/','_blank')">
            <i class="fa-solid fa-shield-dog"></i>
            <span>Get Vet Help For Free</span>
          </div>
        </div>
      </div>
    </div>
    <div class="np-gallery">
      <div class="np-image-container">
        <img src="https://img.freepik.com/free-photo/adorable-puppy-studio_23-2150797088.jpg" alt="New pet 1" class="np-image">
        <img src="https://img.freepik.com/free-photo/adorable-puppy-studio_23-2150797172.jpg" alt="New pet 2" class="np-image">
        <img src="https://img.freepik.com/free-photo/cute-cat-studio_23-2150932333.jpg" alt="New pet 3" class="np-image">
        <img src="https://img.freepik.com/free-photo/cute-tiger-studio_23-2150844453.jpg" alt="New pet 4" class="np-image">
      </div>
    </div>
  </section>

  <section class="premium-diet">
    <div class="premium-diet-container">
      <div class="premium-diet-content">
        <h2>Download Premium Diet Plan</h2>
        <p>Get expert-crafted nutrition plans tailored for your pet's needs. Limited time offer - download our premium diet plans completely free! Ensure your pet gets the balanced nutrition they deserve.</p>
        <a href="./pet_diet_pdf.pdf" class="premium-diet-btn" download="">Download Now - It's Free!</a>
      </div>
      <div class="premium-diet-image">
        <img src="https://img.freepik.com/free-photo/3d-cartoon-hospital-healthcare-scene_23-2151644085.jpg"
          alt="Pet Healthcare" class="premium-diet-img">
      </div>
    </div>
  </section>

  <section class="blog" id="blog">
    <h2 class="section-title"><img src="https://hoppers.wpbingosite.com/wp-content/uploads/2024/11/img-20.png" alt="" style="transform: translateX(20px);">Pet Care Tips & Stories</h2>
    <div class="blog-grid">
      <article class="blog-card">
        <img src="https://img.freepik.com/premium-photo/adorable-corgi-dog-is-smiling-funny-cute-corgi-with-flowers-love_854727-18537.jpg?ga=GA1.1.874350228.1720606149&semt=ais_hybrid"
          alt="Training Tips" class="blog-image">
        <div class="blog-content">
          <h3>Essential Training Tips for New Puppies</h3>
          <p>Learn the fundamentals of puppy training and create a strong bond with your furry friend.</p>
          <div class="blog-meta">
            <span>5 min read</span>
            <a href="https://pawparadise.com/blog/puppy-training" class="read-more">Read More →</a>
          </div>
        </div>
      </article>
      <!-- Other blog cards -->
    </div>
  </section>

  <section class="newsletter-section">
    <div class="newsletter-container">
      <div class="newsletter-images">
        <img src="https://img.freepik.com/free-photo/cartoon-scene-depicting-human-pet-friendship-affection_23-2151444484.jpg"
          alt="Pet friendship 1" class="newsletter-img">
        <img src="https://img.freepik.com/free-photo/cartoon-scene-depicting-human-pet-friendship-affection_23-2151444493.jpg"
          alt="Pet friendship 2" class="newsletter-img">
      </div>
      <div class="newsletter-content">
        <h2>Join Our Pet Parent Community!</h2>
        <p>Subscribe to get special offers, free giveaways, and pawsome updates.</p>
        <form action="https://api.web3forms.com/submit" method="POST" class="newsletter-form">
          <input type="hidden" name="access_key" value="YOUR-ACCESS-KEY-HERE">
          <input type="email" name="email" placeholder="Enter your email" required>
          <button type="submit" class="newsletter-btn">Subscribe</button>
        </form>
      </div>
    </div>
  </section>

  {% include 'footer.html' %}

  <nav class="mobile-bottom-nav">
    <a href="index.html">
      <span class="material-symbols-outlined">home</span>
      <span>Home</span>
    </a>
    <a href="#">
      <span class="material-symbols-outlined">search</span>
      <span>Search</span>
    </a>
    <a href="wishlist.html">
      <span class="material-symbols-outlined">favorite</span>
      <span>Wishlist</span>
    </a>
    <a href="profile.html">
      <span class="material-symbols-outlined">person</span>
      <span>Profile</span>
    </a>
  </nav>

  <script>
    // Initialize carousel controls and fetch product sections
    window.addEventListener('load', () => {
      // Recommended Products
      const recommendedSlider = document.querySelector('#recommended-products');
      const recommendedPrevBtn = document.querySelector('.product-list:nth-of-type(1) .product-slider-control.prev');
      const recommendedNextBtn = document.querySelector('.product-list:nth-of-type(1) .product-slider-control.next');
      let recommendedScrollAmount = 0;

      if (recommendedPrevBtn && recommendedNextBtn && recommendedSlider) {
        recommendedPrevBtn.addEventListener('click', () => {
          recommendedScrollAmount -= recommendedSlider.offsetWidth;
          if (recommendedScrollAmount < 0) recommendedScrollAmount = 0;
          recommendedSlider.scrollTo({ left: recommendedScrollAmount, behavior: 'smooth' });
        });

        recommendedNextBtn.addEventListener('click', () => {
          recommendedScrollAmount += recommendedSlider.offsetWidth;
          if (recommendedScrollAmount >= recommendedSlider.scrollWidth - recommendedSlider.offsetWidth) {
            recommendedScrollAmount = recommendedSlider.scrollWidth - recommendedSlider.offsetWidth;
          }
          recommendedSlider.scrollTo({ left: recommendedScrollAmount, behavior: 'smooth' });
        });
      }

      fetch('{{ url_for("main.home_recommendations") }}')
        .then(response => response.json())
        .then(products => {
          const container = document.getElementById('recommended-products');
          container.innerHTML = '';
          renderProducts(container, products);
        })
        .catch(error => {
          console.error('Error fetching recommendations:', error);
          document.getElementById('recommended-products').innerHTML = 
            '<div class="error-message">Error loading recommended products.</div>';
        });

      // Pet Parent Loves This
      const petParentSlider = document.querySelector('#pet-parent-loves');
      const petParentPrevBtn = document.querySelector('.product-list:nth-of-type(2) .product-slider-control.prev');
      const petParentNextBtn = document.querySelector('.product-list:nth-of-type(2) .product-slider-control.next');
      let petParentScrollAmount = 0;

      if (petParentPrevBtn && petParentNextBtn && petParentSlider) {
        petParentPrevBtn.addEventListener('click', () => {
          petParentScrollAmount -= petParentSlider.offsetWidth;
          if (petParentScrollAmount < 0) petParentScrollAmount = 0;
          petParentSlider.scrollTo({ left: petParentScrollAmount, behavior: 'smooth' });
        });

        petParentNextBtn.addEventListener('click', () => {
          petParentScrollAmount += petParentSlider.offsetWidth;
          if (petParentScrollAmount >= petParentSlider.scrollWidth - petParentSlider.offsetWidth) {
            petParentScrollAmount = petParentSlider.scrollWidth - petParentSlider.offsetWidth;
          }
          petParentSlider.scrollTo({ left: petParentScrollAmount, behavior: 'smooth' });
        });
      }

      fetch('/api/pet_parent_loves')
        .then(response => response.json())
        .then(products => {
          const container = document.getElementById('pet-parent-loves');
          container.innerHTML = '';
          renderProducts(container, products);
        })
        .catch(error => {
          console.error('Error fetching pet parent loves:', error);
          document.getElementById('pet-parent-loves').innerHTML = 
            '<div class="error-message">Error loading products.</div>';
        });

      // Best Sellers
      const bestSellersSlider = document.querySelector('#best-sellers');
      const bestSellersPrevBtn = document.querySelector('.product-list:nth-of-type(3) .product-slider-control.prev');
      const bestSellersNextBtn = document.querySelector('.product-list:nth-of-type(3) .product-slider-control.next');
      let bestSellersScrollAmount = 0;

      if (bestSellersPrevBtn && bestSellersNextBtn && bestSellersSlider) {
        bestSellersPrevBtn.addEventListener('click', () => {
          bestSellersScrollAmount -= bestSellersSlider.offsetWidth;
          if (bestSellersScrollAmount < 0) bestSellersScrollAmount = 0;
          bestSellersSlider.scrollTo({ left: bestSellersScrollAmount, behavior: 'smooth' });
        });

        bestSellersNextBtn.addEventListener('click', () => {
          bestSellersScrollAmount += bestSellersSlider.offsetWidth;
          if (bestSellersScrollAmount >= bestSellersSlider.scrollWidth - bestSellersSlider.offsetWidth) {
            bestSellersScrollAmount = bestSellersSlider.scrollWidth - bestSellersSlider.offsetWidth;
          }
          bestSellersSlider.scrollTo({ left: bestSellersScrollAmount, behavior: 'smooth' });
        });
      }

      fetch('/api/best_sellers')
        .then(response => response.json())
        .then(products => {
          const container = document.getElementById('best-sellers');
          container.innerHTML = '';
          renderProducts(container, products);
        })
        .catch(error => {
          console.error('Error fetching best sellers:', error);
          document.getElementById('best-sellers').innerHTML = 
            '<div class="error-message">Error loading products.</div>';
        });

      // Common function to render product cards
      function renderProducts(container, products) {
        if (products.length === 0) {
          container.innerHTML = '<div class="no-products">No products available.</div>';
          return;
        }

        products.forEach(product => {
          const stars = '★'.repeat(Math.round(product.rating)) + '☆'.repeat(5 - Math.round(product.rating));
          const card = `
            <div class="product-card" data-product-id="${product.id}" 
                 onclick="window.location.href='/product/${product.id}'">
              <div class="product-content">
                <img src="${product.image_url || 'https://placehold.co/200x200/46f27a/ffffff?text=Product'}" 
                     alt="${product.name}">
                <h3>${product.name}</h3>
                <div class="product-details">
                  <span class="product-price">$${product.price.toFixed(2)}</span>
                  <span class="product-rating">${stars} (${product.review_count})</span>
                </div>
              </div>
              <div class="product-actions">
                <button class="add-to-cart" onclick="event.stopPropagation(); addToCart(${product.id}, this)">
                  <span class="material-symbols-outlined">shopping_cart</span> Add to Cart
                </button>
                <button class="add-to-wishlist" onclick="event.stopPropagation(); toggleWishlist(${product.id}, this)">
                  <span class="material-symbols-outlined">favorite</span>
                </button>
              </div>
            </div>
          `;
          container.insertAdjacentHTML('beforeend', card);
        });

        if (window.currentUserId) {
          fetch('{{ url_for("main.check_wishlist_status") }}')
            .then(response => response.json())
            .then(data => {
              const wishlistItems = data.items || [];
              container.querySelectorAll('.product-card').forEach(card => {
                const productId = parseInt(card.dataset.productId);
                if (wishlistItems.includes(productId)) {
                  card.querySelector('.add-to-wishlist').classList.add('in-wishlist');
                }
              });
            });
        }
      }

      // Add to cart function
      function addToCart(productId, button) {
        fetch('/add_to_cart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ product_id: productId })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            button.classList.add('added');
            button.innerHTML = '<span class="material-symbols-outlined">check_circle</span> Added to Cart';
            setTimeout(() => {
              button.classList.remove('added');
              button.innerHTML = '<span class="material-symbols-outlined">shopping_cart</span> Add to Cart';
            }, 3000);
          } else if (data.redirect) {
            window.location.href = data.redirect;
          } else {
            console.error('Error adding to cart:', data.message || 'Unknown error');
          }
        })
        .catch(error => {
          console.error('Error adding to cart:', error);
        });
      }

      // Toggle wishlist function
      function toggleWishlist(productId, button) {
        fetch('/add_to_wishlist', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ product_id: productId })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            button.classList.toggle('in-wishlist');
          } else if (data.redirect) {
            window.location.href = data.redirect;
          } else {
            console.error('Error toggling wishlist:', data.message || 'Unknown error');
          }
        })
        .catch(error => {
          console.error('Error toggling wishlist:', error);
        });
      }
    });
  </script>

  <script src="https://kit.fontawesome.com/51c1e7b4cb.js" crossorigin="anonymous"></script>
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93914fc62e70dd19',t:'MTc0NjEyMzgyMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>